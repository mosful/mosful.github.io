<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§è€³ç‹—ä¹ä¹ä¹˜æ³•ï¼š50é¡Œç‰¹è¨“ç‰ˆ</title>
    <style>
        /* --- å…¨å±€è¨­å®š --- */
        :root {
            --primary-blue: #89CFF0;
            --dark-blue: #5CA0C0;
            --soft-white: #FFFFFF;
            --accent-pink: #FFB7C5;
            --text-color: #444;
            --bg-cloud: #F0F8FF;
            --correct-green: #4CAF50;
            --wrong-red: #FF6B6B;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-cloud);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle, white 20%, transparent 20%),
                radial-gradient(circle, white 20%, transparent 20%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            user-select: none;
        }

        /* --- éŠæˆ²ä¸»å®¹å™¨ --- */
        #game-container {
            background: var(--soft-white);
            width: 95%;
            max-width: 650px; /*ç¨å¾®åŠ å¯¬ä»¥å®¹ç´æ–‡å­—*/
            border-radius: 30px;
            box-shadow: 0 10px 25px rgba(137, 207, 240, 0.5);
            padding: 20px;
            text-align: center;
            border: 6px solid var(--primary-blue);
            box-sizing: border-box;
            position: relative;
            height: 95vh; /* ä½”æ»¿ç•«é¢ */
            display: flex;
            flex-direction: column;
        }

        /* --- é€šç”¨ UI --- */
        h1 { color: var(--dark-blue); margin: 5px 0; font-size: 1.6rem; }

        .character-img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid var(--accent-pink);
            margin: 0 auto 10px auto;
            background-color: #eee;
            display: block;
        }

        /* --- é¸å–®ç•«é¢ --- */
        #menu-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            flex-grow: 1;
            overflow-y: auto;
        }
        
        .mode-section {
            margin: 10px 0;
            padding: 15px;
            background: #F9F9F9;
            border-radius: 20px;
            border: 2px dashed var(--primary-blue);
        }

        .grid-buttons-small {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        /* --- éŠæˆ²ç•«é¢ --- */
        #game-screen { display: none; flex-direction: column; height: 100%; }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            flex-shrink: 0;
        }

        .timer-badge {
            font-size: 1.1rem;
            color: #E65100;
            background: #FFF3E0;
            padding: 5px 10px;
            border-radius: 15px;
            border: 2px solid #FFCC80;
            font-weight: bold;
        }

        /* --- é¡Œç›®é¡¯ç¤ºå€ (é—œéµä¿®æ”¹) --- */
        #question-area {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-y: auto; /* é˜²æ­¢æ–‡å­—éå¤šæº¢å‡º */
            margin: 5px 0;
        }

        /* åŸºç¤æ•¸å­—é¡Œæ¨£å¼ */
        .question-box-basic {
            font-size: 4rem;
            color: var(--text-color);
            font-weight: bold;
        }

        /* ç´ é¤Šé¡Œæ–‡å­—æ¨£å¼ (åŒ…å«æ³¨éŸ³) */
        .story-text {
            font-size: 1.3rem;
            color: #333;
            text-align: left;
            background: #fff;
            padding: 15px;
            border-radius: 15px;
            line-height: 1.8; /* è¡Œè·æ‹‰å¤§ */
            border: 2px solid var(--primary-blue);
            width: 100%;
            box-sizing: border-box;
            word-break: break-all;
        }

        /* æ³¨éŸ³æ¨£å¼ (ç°è‰²å°å­—) */
        .zhu {
            color: #888;
            font-size: 0.85em; /* æ¯”åœ‹å­—ç¨å° */
            margin-right: 2px;
            font-weight: normal;
        }
        
        /* æ•¸å­—å¼·èª¿ */
        .highlight {
            color: #E91E63;
            font-weight: bold;
            font-size: 1.4rem;
            margin: 0 3px;
        }

        /* --- å››é¸ä¸€æŒ‰éˆ•å€ --- */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: auto; /* æ¨åˆ°åº•éƒ¨ */
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .option-btn {
            background-color: white;
            border: 3px solid var(--primary-blue);
            border-radius: 20px;
            color: var(--dark-blue);
            font-size: 2rem;
            padding: 15px 0;
            cursor: pointer;
            box-shadow: 0 4px 0 #B0E0E6;
            transition: all 0.1s;
            font-weight: bold;
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #B0E0E6;
        }

        .option-btn.wrong-anim {
            background-color: #FFEBEE;
            border-color: var(--wrong-red);
            color: var(--wrong-red);
            animation: shake 0.5s;
        }

        .option-btn.correct-anim {
            background-color: #E8F5E9;
            border-color: var(--correct-green);
            color: var(--correct-green);
        }

        /* --- æŒ‰éˆ•èˆ‡å›é¥‹ --- */
        .btn {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            padding: 10px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 0 #5CA0C0;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn-menu { width: 100%; font-size: 1.4rem; padding: 12px; margin: 5px 0; }
        .btn-back { background: #FFD54F; box-shadow: 0 4px 0 #FFB300; color: #333; font-size: 1rem; padding: 8px 15px;}
        .btn-home { background: #ccc; box-shadow: 0 4px 0 #999; font-size: 1rem; padding: 8px 15px;}

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25%, 75% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
        }

        #feedback-area {
            height: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary-blue);
            margin: 5px 0;
            flex-shrink: 0;
        }

    </style>
</head>
<body>

    <div id="game-container">
        
        <div id="menu-screen">
            <img src="https://placehold.co/150x150/89CFF0/FFFFFF?text=Menu" alt="å¤§è€³ç‹—" class="character-img" id="menu-img">
            <h1>å¤§è€³ç‹—ä¹ä¹ä¹˜æ³•</h1>
            
            <div class="mode-section">
                <h3>åŸºç¤ç·´ç¿’ï¼šç§’æ•¸æŒ‘æˆ°</h3>
                <div class="grid-buttons-small">
                    <button class="btn" onclick="startGame('basic', 2)">2</button>
                    <button class="btn" onclick="startGame('basic', 3)">3</button>
                    <button class="btn" onclick="startGame('basic', 4)">4</button>
                    <button class="btn" onclick="startGame('basic', 5)">5</button>
                    <button class="btn" onclick="startGame('basic', 6)">6</button>
                    <button class="btn" onclick="startGame('basic', 7)">7</button>
                    <button class="btn" onclick="startGame('basic', 8)">8</button>
                    <button class="btn" onclick="startGame('basic', 9)">9</button>
                </div>
                <button class="btn btn-menu" style="margin-top:10px;" onclick="startGame('basic', 0)">å…¨éƒ¨æ··åˆæŒ‘æˆ°</button>
            </div>

            <div class="mode-section" style="border-color: #FFB7C5;">
                <h3>é€²éšæŒ‘æˆ°ï¼š50é¡Œç´ é¤Šé¡Œ</h3>
                <button class="btn btn-menu" style="background-color: #FF9800; box-shadow: 0 4px 0 #E65100;" onclick="startGame('story', 0)">é–‹å§‹é–±è®€æŒ‘æˆ°</button>
            </div>
        </div>

        <div id="game-screen">
            <div class="top-bar">
                <button class="btn btn-back" id="btn-undo" onclick="undoLast()">â†© ä¸Šä¸€é¡Œ</button>
                <div id="timer-display" class="timer-badge">â±ï¸ 0.0 ç§’</div>
                <button class="btn btn-home" onclick="goHome()">ğŸ </button>
            </div>

            <img src="https://placehold.co/150x150/89CFF0/FFFFFF?text=Thinking" alt="æ€è€ƒä¸­" class="character-img" id="game-img">
            
            <div id="question-area"></div>
            
            <div id="feedback-area"></div>

            <div id="options-area" class="options-grid"></div>
        </div>

    </div>

    <script>
        // éŸ³æ•ˆ (Web Audio API)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523.25, audioCtx.currentTime);
                osc.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        // åœ–ç‰‡
        const IMAGES = {
            normal: "https://placehold.co/150x150/89CFF0/FFFFFF?text=Hello",
            happy: "https://placehold.co/150x150/98FB98/FFFFFF?text=Happy!",
            sad: "https://placehold.co/150x150/FFB7C5/FFFFFF?text=Oh+No"
        };

        // --- 50é¡Œç´ é¤Šé¡Œåº« (åœ‹å­—+æ³¨éŸ³ä¸¦åˆ—æ ¼å¼) ---
        // æ ¼å¼èªªæ˜: t: é¡Œç›®æ–‡å­—, a: ç­”æ¡ˆ
        // ç‚ºäº†é–±è®€æ–¹ä¾¿ï¼Œæ³¨éŸ³å·²ç¶“ç›´æ¥æ’ç‰ˆåœ¨åœ‹å­—æ—é‚Šï¼Œä¾‹å¦‚ï¼šä¸€(ã„§)
        const storyQuestions = [
            { t: "ä¸€(ã„§Ë‹) éš»(ã„“) å¤§(ã„‰ã„šË‹) è€³(ã„¦Ë‡) ç‹—(ã„ã„¡Ë‡) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>2</span> éš»(ã„“) è€³(ã„¦Ë‡) æœµ(ã„‰ã„¨ã„›Ë™) ï¼Œ <span class='highlight'>6</span> éš»(ã„“) å¤§(ã„‰ã„šË‹) è€³(ã„¦Ë‡) ç‹—(ã„ã„¡Ë‡) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) è€³(ã„¦Ë‡) æœµ(ã„‰ã„¨ã„›Ë™) ï¼Ÿ", a: 12 },
            { t: "è…³(ã„ã„§ã„ Ë‡) è¸(ã„Šã„šË‹) è»Š(ã„”ã„œ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>2</span> å€‹(ã„ã„œË™) è¼ª(ã„Œã„¨ã„£ËŠ) å­(ã„—Ë™) ï¼Œ <span class='highlight'>9</span> è¼›(ã„Œã„§ã„¤Ë‹) è…³(ã„ã„§ã„ Ë‡) è¸(ã„Šã„šË‹) è»Š(ã„”ã„œ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) è¼ª(ã„Œã„¨ã„£ËŠ) å­(ã„—Ë™) ï¼Ÿ", a: 18 },
            { t: "ä¸€(ã„§Ë‹) é›™(ã„•ã„¨ã„¤) ç­·(ã„ã„¨ã„Ë‹) å­(ã„—Ë™) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>2</span> æ ¹(ã„ã„£) ï¼Œ <span class='highlight'>8</span> é›™(ã„•ã„¨ã„¤) ç­·(ã„ã„¨ã„Ë‹) å­(ã„—Ë™) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) æ ¹(ã„ã„£) ï¼Ÿ", a: 16 },
            { t: "äºº(ã„–ã„£ËŠ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>2</span> éš»(ã„“) çœ¼(ã„§ã„¢Ë‡) ç›(ã„ã„§ã„¥) ï¼Œ <span class='highlight'>5</span> å€‹(ã„ã„œË™) äºº(ã„–ã„£ËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) çœ¼(ã„§ã„¢Ë‡) ç›(ã„ã„§ã„¥) ï¼Ÿ", a: 10 },
            { t: "ä¸€(ã„§Ë‹) é›™(ã„•ã„¨ã„¤) é‹(ã„’ã„§ã„ËŠ) å­(ã„—Ë™) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>2</span> éš»(ã„“) ï¼Œ <span class='highlight'>7</span> é›™(ã„•ã„¨ã„¤) é‹(ã„’ã„§ã„ËŠ) å­(ã„—Ë™) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) ï¼Ÿ", a: 14 },
            { t: "ä¸‰(ã„™ã„¢) è¼ª(ã„Œã„¨ã„£ËŠ) è»Š(ã„”ã„œ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>3</span> å€‹(ã„ã„œË™) è¼ª(ã„Œã„¨ã„£ËŠ) å­(ã„—Ë™) ï¼Œ <span class='highlight'>4</span> è¼›(ã„Œã„§ã„¤Ë‹) ä¸‰(ã„™ã„¢) è¼ª(ã„Œã„¨ã„£ËŠ) è»Š(ã„”ã„œ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) è¼ª(ã„Œã„¨ã„£ËŠ) å­(ã„—Ë™) ï¼Ÿ", a: 12 },
            { t: "å¸ƒ(ã„…ã„¨Ë‹) ä¸(ã„‰ã„§ã„¥) <span class='highlight'>3</span> å€‹(ã„ã„œË™) è£(ã„“ã„¨ã„¤) ä¸€(ã„§Ë‹) ç›’(ã„ã„œËŠ) ï¼Œ <span class='highlight'>6</span> ç›’(ã„ã„œËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) å¸ƒ(ã„…ã„¨Ë‹) ä¸(ã„‰ã„§ã„¥) ï¼Ÿ", a: 18 },
            { t: "ä¸€(ã„§Ë‹) å¤©(ã„Šã„§ã„¢) åƒ(ã„”) <span class='highlight'>3</span> é¤(ã„˜ã„¢) ï¼Œ <span class='highlight'>5</span> å¤©(ã„Šã„§ã„¢) å…±(ã„ã„¨ã„¥Ë‹) åƒ(ã„”) äº†(ã„Œã„œË™) å¹¾(ã„ã„§Ë‡) é¤(ã„˜ã„¢) ï¼Ÿ", a: 15 },
            { t: "å¼Ÿ(ã„‰ã„§Ë‹) å¼Ÿ(ã„‰ã„§Ë™) æ¯(ã„‡ã„ŸË‡) å¤©(ã„Šã„§ã„¢) å­˜(ã„˜ã„¨ã„£ËŠ) <span class='highlight'>3</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ <span class='highlight'>9</span> å¤©(ã„Šã„§ã„¢) å¯(ã„ã„œË‡) ä»¥(ã„§Ë‡) å­˜(ã„˜ã„¨ã„£ËŠ) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 27 },
            { t: "å¹¸(ã„’ã„§ã„¥Ë‹) é‹(ã„©ã„£Ë‹) è‰(ã„˜ã„ Ë‡) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>3</span> ç‰‡(ã„†ã„§ã„¢Ë‹) è‘‰(ã„§ã„Ë‹) å­(ã„—Ë™) ï¼Œ <span class='highlight'>8</span> æ ª(ã„“ã„¨) å¹¸(ã„’ã„§ã„¥Ë‹) é‹(ã„©ã„£Ë‹) è‰(ã„˜ã„ Ë‡) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) ç‰‡(ã„†ã„§ã„¢Ë‹) è‘‰(ã„§ã„Ë‹) å­(ã„—Ë™) ï¼Ÿ", a: 24 },
            { t: "æ±½(ã„‘ã„§Ë‹) è»Š(ã„”ã„œ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>4</span> å€‹(ã„ã„œË™) è¼ª(ã„Œã„¨ã„£ËŠ) å­(ã„—Ë™) ï¼Œ <span class='highlight'>5</span> è¼›(ã„Œã„§ã„¤Ë‹) æ±½(ã„‘ã„§Ë‹) è»Š(ã„”ã„œ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) è¼ª(ã„Œã„¨ã„£ËŠ) å­(ã„—Ë™) ï¼Ÿ", a: 20 },
            { t: "æ¤…(ã„§Ë‡) å­(ã„—Ë™) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>4</span> éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Œ <span class='highlight'>6</span> å¼µ(ã„“ã„¤) æ¤…(ã„§Ë‡) å­(ã„—Ë™) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Ÿ", a: 24 },
            { t: "å°(ã„’ã„§ã„ Ë‡) ç‹—(ã„ã„¡Ë‡) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>4</span> æ¢(ã„Šã„§ã„ ËŠ) è…¿(ã„Šã„¨ã„ŸË‡) ï¼Œ <span class='highlight'>3</span> éš»(ã„“) å°(ã„’ã„§ã„ Ë‡) ç‹—(ã„ã„¡Ë‡) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) æ¢(ã„Šã„§ã„ ËŠ) è…¿(ã„Šã„¨ã„ŸË‡) ï¼Ÿ", a: 12 },
            { t: "ä¸€(ã„§Ë‹) ç›’(ã„ã„œËŠ) é»(ã„‰ã„§ã„¢Ë‡) å¿ƒ(ã„’ã„§ã„£) <span class='highlight'>4</span> å€‹(ã„ã„œË™) ï¼Œ <span class='highlight'>9</span> ç›’(ã„ã„œËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) é»(ã„‰ã„§ã„¢Ë‡) å¿ƒ(ã„’ã„§ã„£) ï¼Ÿ", a: 36 },
            { t: "æ­£(ã„“ã„¥Ë‹) æ–¹(ã„ˆã„¤) å½¢(ã„’ã„§ã„¥ËŠ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>4</span> å€‹(ã„ã„œË™) é‚Š(ã„…ã„§ã„¢) ï¼Œ <span class='highlight'>7</span> å€‹(ã„ã„œË™) æ­£(ã„“ã„¥Ë‹) æ–¹(ã„ˆã„¤) å½¢(ã„’ã„§ã„¥ËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) é‚Š(ã„…ã„§ã„¢) ï¼Ÿ", a: 28 },
            { t: "ä¸€(ã„§Ë‹) éš»(ã„“) æ‰‹(ã„•ã„¡Ë‡) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>5</span> æ ¹(ã„ã„£) æ‰‹(ã„•ã„¡Ë‡) æŒ‡(ã„“Ë‡) é ­(ã„Šã„¡Ë™) ï¼Œ <span class='highlight'>4</span> éš»(ã„“) æ‰‹(ã„•ã„¡Ë‡) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) æ ¹(ã„ã„£) ï¼Ÿ", a: 20 },
            { t: "æµ·(ã„ã„Ë‡) æ˜Ÿ(ã„’ã„§ã„¥) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>5</span> å€‹(ã„ã„œË™) è§’(ã„ã„§ã„ Ë‡) ï¼Œ <span class='highlight'>6</span> éš»(ã„“) æµ·(ã„ã„Ë‡) æ˜Ÿ(ã„’ã„§ã„¥) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) è§’(ã„ã„§ã„ Ë‡) ï¼Ÿ", a: 30 },
            { t: "èŠ±(ã„ã„¨ã„š) æœµ(ã„‰ã„¨ã„›Ë‡) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>5</span> ç‰‡(ã„†ã„§ã„¢Ë‹) èŠ±(ã„ã„¨ã„š) ç“£(ã„…ã„¢Ë‹) ï¼Œ <span class='highlight'>9</span> æœµ(ã„‰ã„¨ã„›Ë‡) èŠ±(ã„ã„¨ã„š) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) ç‰‡(ã„†ã„§ã„¢Ë‹) èŠ±(ã„ã„¨ã„š) ç“£(ã„…ã„¢Ë‹) ï¼Ÿ", a: 45 },
            { t: "ä¸€(ã„§Ë‹) å€‹(ã„ã„œË™) éŠ…(ã„Šã„¨ã„¥ËŠ) æ¿(ã„…ã„¢Ë‡) <span class='highlight'>5</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ <span class='highlight'>8</span> å€‹(ã„ã„œË™) éŠ…(ã„Šã„¨ã„¥ËŠ) æ¿(ã„…ã„¢Ë‡) æ˜¯(ã„•Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 40 },
            { t: "å°(ã„’ã„§ã„ Ë‡) æœ‹(ã„†ã„¥ËŠ) å‹(ã„§ã„¡Ë‡) <span class='highlight'>5</span> äºº(ã„–ã„£ËŠ) ä¸€(ã„§Ë‹) çµ„(ã„—ã„¨Ë‡) ï¼Œ <span class='highlight'>7</span> çµ„(ã„—ã„¨Ë‡) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) äºº(ã„–ã„£ËŠ) ï¼Ÿ", a: 35 },
            { t: "è(ã„‡ã„šË‡) èŸ»(ã„§Ë‡) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>6</span> éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Œ <span class='highlight'>3</span> éš»(ã„“) è(ã„‡ã„šË‡) èŸ»(ã„§Ë‡) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Ÿ", a: 18 },
            { t: "ä¸€(ã„§Ë‹) ç›’(ã„ã„œËŠ) é›(ã„ã„§) è›‹(ã„‰ã„¢Ë‹) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>6</span> é¡†(ã„ã„œ) ï¼Œ <span class='highlight'>5</span> ç›’(ã„ã„œËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) é¡†(ã„ã„œ) é›(ã„ã„§) è›‹(ã„‰ã„¢Ë‹) ï¼Ÿ", a: 30 },
            { t: "èœœ(ã„‡ã„§Ë‹) èœ‚(ã„ˆã„¥) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>6</span> éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Œ <span class='highlight'>8</span> éš»(ã„“) èœœ(ã„‡ã„§Ë‹) èœ‚(ã„ˆã„¥) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Ÿ", a: 48 },
            { t: "ä¸€(ã„§Ë‹) ç®±(ã„’ã„§ã„¤) é£²(ã„§ã„£Ë‡) æ–™(ã„Œã„§ã„ Ë‹) <span class='highlight'>6</span> ç“¶(ã„†ã„§ã„¥ËŠ) ï¼Œ <span class='highlight'>9</span> ç®±(ã„’ã„§ã„¤) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) ç“¶(ã„†ã„§ã„¥ËŠ) ï¼Ÿ", a: 54 },
            { t: "éª°(ã„Šã„¡ËŠ) å­(ã„—Ë™) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>6</span> å€‹(ã„ã„œË™) é¢(ã„‡ã„§ã„¢Ë‹) ï¼Œ <span class='highlight'>4</span> é¡†(ã„ã„œ) éª°(ã„Šã„¡ËŠ) å­(ã„—Ë™) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) é¢(ã„‡ã„§ã„¢Ë‹) ï¼Ÿ", a: 24 },
            { t: "ä¸€(ã„§Ë‹) æ˜Ÿ(ã„’ã„§ã„¥) æœŸ(ã„‘ã„§ËŠ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>7</span> å¤©(ã„Šã„§ã„¢) ï¼Œ <span class='highlight'>2</span> å€‹(ã„ã„œË™) æ˜Ÿ(ã„’ã„§ã„¥) æœŸ(ã„‘ã„§ËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å¤©(ã„Šã„§ã„¢) ï¼Ÿ", a: 14 },
            { t: "å½©(ã„˜ã„Ë‡) è™¹(ã„ã„¨ã„¥ËŠ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>7</span> ç¨®(ã„“ã„¨ã„¥Ë‡) é¡(ã„§ã„¢ËŠ) è‰²(ã„™ã„œË‹) ï¼Œ <span class='highlight'>3</span> é“(ã„‰ã„ Ë‹) å½©(ã„˜ã„Ë‡) è™¹(ã„ã„¨ã„¥ËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) ç¨®(ã„“ã„¨ã„¥Ë‡) é¡(ã„§ã„¢ËŠ) è‰²(ã„™ã„œË‹) ï¼Ÿ", a: 21 },
            { t: "å°(ã„’ã„§ã„ Ë‡)çŸ®(ã„Ë‡)äºº(ã„–ã„£ËŠ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>7</span> å€‹(ã„ã„œË™) ï¼Œ <span class='highlight'>5</span> çµ„(ã„—ã„¨Ë‡) å°(ã„’ã„§ã„ Ë‡)çŸ®(ã„Ë‡)äºº(ã„–ã„£ËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) ï¼Ÿ", a: 35 },
            { t: "ä¸€(ã„§Ë‹) åŒ…(ã„…ã„ ) ç³–(ã„Šã„¤ËŠ) æœ(ã„ã„¨ã„›Ë‡) <span class='highlight'>7</span> é¡†(ã„ã„œ) ï¼Œ <span class='highlight'>8</span> åŒ…(ã„…ã„ ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) é¡†(ã„ã„œ) ï¼Ÿ", a: 56 },
            { t: "åŒ—(ã„…ã„ŸË‡) æ–—(ã„‰ã„¡Ë‡) ä¸ƒ(ã„‘ã„§) æ˜Ÿ(ã„’ã„§ã„¥) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>7</span> é¡†(ã„ã„œ) æ˜Ÿ(ã„’ã„§ã„¥) æ˜Ÿ(ã„’ã„§ã„¥) ï¼Œ <span class='highlight'>9</span> å€‹(ã„ã„œË™) æ˜Ÿ(ã„’ã„§ã„¥) åº§(ã„—ã„¨ã„›Ë‹) å…±(ã„ã„¨ã„¥Ë‹) å¹¾(ã„ã„§Ë‡) é¡†(ã„ã„œ) ï¼Ÿ", a: 63 },
            { t: "èœ˜(ã„“) è››(ã„“ã„¨) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>8</span> éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Œ <span class='highlight'>3</span> éš»(ã„“) èœ˜(ã„“) è››(ã„“ã„¨) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Ÿ", a: 24 },
            { t: "ç« (ã„“ã„¤) é­š(ã„©ËŠ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>8</span> éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Œ <span class='highlight'>6</span> éš»(ã„“) ç« (ã„“ã„¤) é­š(ã„©ËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Ÿ", a: 48 },
            { t: "ä¸€(ã„§Ë‹) ç›’(ã„ã„œËŠ) è Ÿ(ã„Œã„šË‹) ç­†(ã„…ã„§Ë‡) <span class='highlight'>8</span> æ(ã„“) ï¼Œ <span class='highlight'>5</span> ç›’(ã„ã„œËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) æ(ã„“) ï¼Ÿ", a: 40 },
            { t: "æŠ«(ã„†ã„§) è–©(ã„™ã„šË‹) åˆ‡(ã„‘ã„§ã„) æˆ(ã„”ã„¥ËŠ) <span class='highlight'>8</span> ç‰‡(ã„†ã„§ã„¢Ë‹) ï¼Œ <span class='highlight'>4</span> å€‹(ã„ã„œË™) æŠ«(ã„†ã„§) è–©(ã„™ã„šË‹) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) ç‰‡(ã„†ã„§ã„¢Ë‹) ï¼Ÿ", a: 32 },
            { t: "è²·(ã„‡ã„Ë‡) ä¸€(ã„§Ë‹) æ(ã„“) ç­†(ã„…ã„§Ë‡) <span class='highlight'>8</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>9</span> æ(ã„“) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 72 },
            { t: "æ£’(ã„…ã„¤Ë‹) çƒ(ã„‘ã„§ã„¡ËŠ) éšŠ(ã„‰ã„¨ã„ŸË‹) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>9</span> å€‹(ã„ã„œË™) äºº(ã„–ã„£ËŠ) ï¼Œ <span class='highlight'>2</span> å€‹(ã„ã„œË™) çƒ(ã„‘ã„§ã„¡ËŠ) éšŠ(ã„‰ã„¨ã„ŸË‹) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) äºº(ã„–ã„£ËŠ) ï¼Ÿ", a: 18 },
            { t: "ä¸€(ã„§Ë‹) å€‹(ã„ã„œË™) è‚‰(ã„–ã„¡Ë‹) æ¡‚(ã„ã„¨ã„ŸË‹) æ²(ã„ã„©ã„¢Ë‡) <span class='highlight'>9</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>5</span> å€‹(ã„ã„œË™) è¦(ã„§ã„ Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 45 },
            { t: "ä¸€(ã„§Ë‹) ç›’(ã„ã„œËŠ) å·§(ã„‘ã„§ã„ Ë‡) å…‹(ã„ã„œË‹) åŠ›(ã„Œã„§Ë‹) <span class='highlight'>9</span> é¡†(ã„ã„œ) ï¼Œ <span class='highlight'>3</span> ç›’(ã„ã„œËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) é¡†(ã„ã„œ) ï¼Ÿ", a: 27 },
            { t: "è˜‹(ã„†ã„§ã„£ËŠ) æœ(ã„ã„¨ã„›Ë‡) ä¸€(ã„§Ë‹) é¡†(ã„ã„œ) <span class='highlight'>9</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ åª½(ã„‡ã„š) åª½(ã„‡ã„š) è²·(ã„‡ã„Ë‡) <span class='highlight'>7</span> é¡†(ã„ã„œ) è¦(ã„§ã„ Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 63 },
            { t: "ä¹(ã„ã„§ã„¡Ë‡) å®®(ã„ã„¨ã„¥) æ ¼(ã„ã„œËŠ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>9</span> æ ¼(ã„ã„œËŠ) ï¼Œ <span class='highlight'>4</span> å¼µ(ã„“ã„¤) ç´™(ã„“Ë‡) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) æ ¼(ã„ã„œËŠ) ï¼Ÿ", a: 36 },
            { t: "æ°£(ã„‘ã„§Ë‹) çƒ(ã„‘ã„§ã„¡ËŠ) ä¸€(ã„§Ë‹) å€‹(ã„ã„œË™) <span class='highlight'>2</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>8</span> å€‹(ã„ã„œË™) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 16 },
            { t: "å£(ã„ã„¡Ë‡) ç½©(ã„“ã„ Ë‹) ä¸€(ã„§Ë‹) ç‰‡(ã„†ã„§ã„¢Ë‹) <span class='highlight'>3</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>7</span> ç‰‡(ã„†ã„§ã„¢Ë‹) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 21 },
            { t: "è²¼(ã„Šã„§ã„) ç´™(ã„“Ë‡) ä¸€(ã„§Ë‹) å¼µ(ã„“ã„¤) <span class='highlight'>4</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>6</span> å¼µ(ã„“ã„¤) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 24 },
            { t: "é‰›(ã„‘ã„§ã„¢) ç­†(ã„…ã„§Ë‡) ä¸€(ã„§Ë‹) æ(ã„“) <span class='highlight'>5</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>9</span> æ(ã„“) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 45 },
            { t: "ç©(ã„¨ã„¢ËŠ) å…·(ã„ã„©Ë‹) è»Š(ã„”ã„œ) <span class='highlight'>6</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>3</span> è¼›(ã„Œã„§ã„¤Ë‹) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 18 },
            { t: "ç­†(ã„…ã„§Ë‡) è¨˜(ã„ã„§Ë‹) æœ¬(ã„…ã„£Ë‡) <span class='highlight'>7</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>4</span> æœ¬(ã„…ã„£Ë‡) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 28 },
            { t: "å†°(ã„…ã„§ã„¥) æ·‡(ã„‘ã„§ËŠ) æ·‹(ã„Œã„§ã„£ËŠ) <span class='highlight'>8</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>2</span> æ”¯(ã„“) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 16 },
            { t: "ä¸‰(ã„™ã„¢) æ˜(ã„‡ã„§ã„¥ËŠ) æ²»(ã„“Ë‹) <span class='highlight'>9</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>6</span> å€‹(ã„ã„œË™) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 54 },
            { t: "å°º(ã„”Ë‡) ä¸€(ã„§Ë‹) æŠŠ(ã„…ã„šË‡) <span class='highlight'>5</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>5</span> æŠŠ(ã„…ã„šË‡) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 25 },
            { t: "æ©¡(ã„’ã„§ã„¤Ë‹) çš®(ã„†ã„§ËŠ) æ“¦(ã„˜ã„š) <span class='highlight'>4</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>8</span> å€‹(ã„ã„œË™) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 32 }
        ];

        // --- è®Šæ•¸ ---
        let state = {
            mode: 'basic',
            targetNum: 0,
            currentQ: null,
            history: [],
            startTime: 0,
            timerInterval: null
        };

        function goHome() {
            clearInterval(state.timerInterval);
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('menu-screen').style.display = 'flex';
        }

        function startGame(mode, num) {
            state.mode = mode;
            state.targetNum = num;
            state.history = [];
            
            document.getElementById('menu-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            
            nextQuestion(false);
        }

        function nextQuestion(isUndo) {
            if (!isUndo && state.currentQ) {
                state.history.push({...state.currentQ});
            }

            if (!isUndo) {
                state.currentQ = generateQuestionData();
            }

            renderGame();
            startTimer();
        }

        function generateQuestionData() {
            let qText, qAns, options;
            
            if (state.mode === 'story') {
                const q = storyQuestions[Math.floor(Math.random() * storyQuestions.length)];
                qText = q.t;
                qAns = q.a;
                // å°‡é¡Œç›®ä¸­çš„(æ³¨éŸ³)ç”¨spanåŒ…èµ·ä¾†ï¼Œè®Šæˆç°è‰²å°å­—
                qText = qText.replace(/\(([^)]+)\)/g, "<span class='zhu'>$1</span>");
            } else {
                let n1, n2;
                if (state.targetNum === 0) {
                    n1 = Math.floor(Math.random() * 8) + 2; 
                    n2 = Math.floor(Math.random() * 9) + 1;
                } else {
                    n1 = state.targetNum;
                    n2 = Math.floor(Math.random() * 9) + 1;
                }
                qText = `${n1} Ã— ${n2} = ?`;
                qAns = n1 * n2;
            }

            options = generateOptions(qAns);
            return { text: qText, ans: qAns, options: options, type: state.mode };
        }

        function generateOptions(correctAnswer) {
            let opts = new Set();
            opts.add(correctAnswer);
            while(opts.size < 4) {
                let offset = Math.floor(Math.random() * 10) - 5; 
                let wrong = correctAnswer + offset;
                if (wrong > 0 && wrong !== correctAnswer) opts.add(wrong);
            }
            return Array.from(opts).sort(() => Math.random() - 0.5);
        }

        function startTimer() {
            clearInterval(state.timerInterval);
            state.startTime = Date.now();
            document.getElementById('timer-display').innerText = "â±ï¸ 0.0 ç§’";
            document.getElementById('feedback-area').innerText = "";
            
            if (state.mode === 'basic') {
                state.timerInterval = setInterval(() => {
                    let now = Date.now();
                    let seconds = ((now - state.startTime) / 1000).toFixed(1);
                    document.getElementById('timer-display').innerText = `â±ï¸ ${seconds} ç§’`;
                }, 100);
            } else {
                document.getElementById('timer-display').innerText = "é–±è®€æŒ‘æˆ°"; 
            }
        }

        function renderGame() {
            const qArea = document.getElementById('question-area');
            const optArea = document.getElementById('options-area');
            const img = document.getElementById('game-img');
            const undoBtn = document.getElementById('btn-undo');

            img.src = IMAGES.normal;
            undoBtn.disabled = (state.history.length === 0);

            if (state.currentQ.type === 'story') {
                qArea.innerHTML = `<div class='story-text'>${state.currentQ.text}</div>`;
            } else {
                qArea.innerHTML = `<div class='question-box-basic'>${state.currentQ.text}</div>`;
            }

            optArea.innerHTML = "";
            state.currentQ.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt, btn);
                optArea.appendChild(btn);
            });
        }

        function checkAnswer(selectedVal, btnElement) {
            clearInterval(state.timerInterval);
            const timeTaken = ((Date.now() - state.startTime) / 1000).toFixed(1);
            const feedback = document.getElementById('feedback-area');
            const img = document.getElementById('game-img');

            if (selectedVal === state.currentQ.ans) {
                playSound('correct');
                btnElement.classList.add('correct-anim');
                img.src = IMAGES.happy;
                
                if (state.mode === 'basic') {
                    feedback.innerText = `ç­”å°äº†ï¼è€—æ™‚ ${timeTaken} ç§’`;
                } else {
                    feedback.innerText = "å¥½æ£’å–”ï¼ç­”å°äº†ï¼";
                }
                
                disableAllButtons();
                setTimeout(() => nextQuestion(false), 1500);
            } else {
                playSound('wrong');
                btnElement.classList.add('wrong-anim');
                img.src = IMAGES.sad;
                feedback.innerText = "å†è©¦è©¦çœ‹ï¼";
            }
        }

        function disableAllButtons() {
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.disabled = true);
        }

        function undoLast() {
            if (state.history.length === 0) return;
            const prev = state.history.pop();
            state.currentQ = prev;
            renderGame(); // é‡ç¹ªä½†ä¸é‡æ–°è¨ˆæ™‚æˆ–å¯é¸é‡ç½®
            // é€™è£¡ç°¡å–®è™•ç†ï¼šå›åˆ°ä¸Šä¸€é¡Œç‹€æ…‹ï¼Œå…è¨±é‡ç­”
            startTimer(); 
        }
    </script>
</body>
</html>
