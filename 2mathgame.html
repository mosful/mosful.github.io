<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§è€³ç‹—ä¹ä¹ä¹˜æ³•ï¼šå®Œæ•´ç·´ç¿’ç‰ˆ</title>
    <style>
        /* --- å…¨å±€è¨­å®š --- */
        :root {
            --primary-blue: #89CFF0;
            --dark-blue: #5CA0C0;
            --soft-white: #FFFFFF;
            --accent-pink: #FFB7C5;
            --text-color: #444;
            --bg-cloud: #F0F8FF;
            --correct-green: #4CAF50;
            --wrong-red: #FF6B6B;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-cloud);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle, white 20%, transparent 20%),
                radial-gradient(circle, white 20%, transparent 20%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            user-select: none;
        }

        /* --- ä¸»å®¹å™¨ --- */
        #game-container {
            background: var(--soft-white);
            width: 95%;
            max-width: 600px;
            border-radius: 30px;
            box-shadow: 0 10px 25px rgba(137, 207, 240, 0.5);
            padding: 20px;
            text-align: center;
            border: 6px solid var(--primary-blue);
            box-sizing: border-box;
            position: relative;
            min-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        h1 { color: var(--dark-blue); margin: 10px 0 5px 0; font-size: 1.8rem; }

        /* åœ–ç‰‡åœ“æ¡†æ¨£å¼ */
        .character-img {
            width: 130px;
            height: 130px;
            object-fit: cover;
            border-radius: 50%;
            border: 4px solid var(--primary-blue);
            margin: 0 auto 10px auto;
            background-color: #F0F8FF;
            display: block;
            box-shadow: 0 5px 15px rgba(137, 207, 240, 0.3);
        }
        
        #game-img, #report-img {
             width: 110px;
             height: 110px;
             border-color: var(--accent-pink);
        }

        /* --- ç•«é¢åˆ‡æ›æ§åˆ¶ --- */
        .screen { display: none; flex-direction: column; height: 100%; flex-grow: 1; }
        .screen.active { display: flex; }

        /* --- é¸å–®ç•«é¢ --- */
        .mode-section {
            margin: 10px 0;
            padding: 15px;
            background: #F9F9F9;
            border-radius: 20px;
            border: 2px dashed var(--primary-blue);
        }

        .grid-buttons-small {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        /* --- é–‹é—œæŒ‰éˆ• (Switch) --- */
        .switch-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            font-size: 1.2rem;
            color: var(--dark-blue);
            font-weight: bold;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            margin-right: 10px;
        }
        
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider { background-color: var(--primary-blue); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* --- éŠæˆ²ç•«é¢ --- */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            flex-shrink: 0;
        }

        .info-badge {
            font-size: 1.1rem;
            background: #FFF3E0;
            padding: 5px 12px;
            border-radius: 15px;
            border: 2px solid #FFCC80;
            font-weight: bold;
            color: #E65100;
        }

        #question-area {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px 0;
        }

        .question-box-basic {
            font-size: 4.5rem;
            color: var(--text-color);
            font-weight: bold;
        }

        .story-text {
            font-size: 1.4rem;
            color: #333;
            text-align: left;
            background: #fff;
            padding: 15px;
            border-radius: 15px;
            line-height: 1.8;
            border: 2px solid var(--primary-blue);
            width: 100%;
            box-sizing: border-box;
        }
        .zhu { color: #888; font-size: 0.8em; margin-right: 2px; font-weight: normal; }
        .highlight { color: #E91E63; font-weight: bold; font-size: 1.5rem; margin: 0 3px; }

        /* --- é¸é …å€ --- */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: auto;
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .option-btn {
            background-color: white;
            border: 3px solid var(--primary-blue);
            border-radius: 20px;
            color: var(--dark-blue);
            font-size: 2.2rem;
            padding: 15px 0;
            cursor: pointer;
            box-shadow: 0 4px 0 #B0E0E6;
            transition: all 0.1s;
            font-weight: bold;
        }

        .option-btn:active { transform: translateY(4px); box-shadow: 0 1px 0 #B0E0E6; }
        .option-btn.wrong-anim { background-color: #FFEBEE; border-color: var(--wrong-red); color: var(--wrong-red); animation: shake 0.5s; }
        .option-btn.correct-anim { background-color: #E8F5E9; border-color: var(--correct-green); color: var(--correct-green); }

        /* --- çµç®—ç•«é¢ --- */
        #report-screen {
            text-align: center;
            padding-top: 20px;
        }
        .result-box {
            background: #fff;
            padding: 20px;
            border-radius: 20px;
            border: 4px solid var(--primary-blue);
            margin: 20px 0;
        }
        .result-item {
            font-size: 1.5rem;
            margin: 15px 0;
            color: #555;
            text-align: left;
            border-bottom: 1px dashed #ddd;
            padding-bottom: 10px;
        }
        .result-value {
            float: right;
            font-weight: bold;
            color: var(--primary-blue);
        }

        /* --- æŒ‰éˆ• --- */
        .btn { background-color: var(--primary-blue); color: white; border: none; padding: 10px; font-size: 1.3rem; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 0 #5CA0C0; }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn-menu { width: 100%; margin: 5px 0; }
        .btn-back { background: #FFD54F; box-shadow: 0 4px 0 #FFB300; color: #333; font-size: 1rem; padding: 8px 15px;}
        .btn-home { background: #ccc; box-shadow: 0 4px 0 #999; font-size: 1rem; padding: 8px 15px;}
        .btn-restart { background-color: #4CAF50; box-shadow: 0 4px 0 #2E7D32; width: 100%; margin-top: 20px; padding: 15px;}

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25%, 75% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
        }

    </style>
</head>
<body>

    <div id="game-container">
        
        <div id="menu-screen" class="screen active">
            <img src="menu_cinnamoroll.png" alt="å¤§è€³ç‹—é£›ç¿”" class="character-img" id="menu-img">
            <h1>å¤§è€³ç‹—ä¹ä¹ä¹˜æ³•</h1>
            
            <div class="switch-container">
                <label class="toggle-switch">
                    <input type="checkbox" id="timer-toggle">
                    <span class="slider"></span>
                </label>
                <span>é–‹å•Ÿç§’æ•¸æŒ‘æˆ°</span>
            </div>

            <div class="mode-section">
                <h3>åŸºç¤ç·´ç¿’ (æ¯å›10é¡Œä¸é‡è¤‡)</h3>
                <div class="grid-buttons-small">
                    <button class="btn" onclick="initGame('basic', 2)">2</button>
                    <button class="btn" onclick="initGame('basic', 3)">3</button>
                    <button class="btn" onclick="initGame('basic', 4)">4</button>
                    <button class="btn" onclick="initGame('basic', 5)">5</button>
                    <button class="btn" onclick="initGame('basic', 6)">6</button>
                    <button class="btn" onclick="initGame('basic', 7)">7</button>
                    <button class="btn" onclick="initGame('basic', 8)">8</button>
                    <button class="btn" onclick="initGame('basic', 9)">9</button>
                </div>
                <button class="btn btn-menu" style="margin-top:10px;" onclick="initGame('basic', 0)">å…¨éƒ¨æ··åˆç·´ç¿’</button>
            </div>

            <div class="mode-section" style="border-color: #FFB7C5;">
                <h3>é€²éšæŒ‘æˆ° (50é¡Œé¡Œåº«)</h3>
                <button class="btn btn-menu" style="background-color: #FF9800; box-shadow: 0 4px 0 #E65100;" onclick="initGame('story', 0)">ç´ é¤Šé–±è®€æŒ‘æˆ°</button>
            </div>
        </div>

        <div id="game-screen" class="screen">
            <div class="top-bar">
                <button class="btn btn-back" id="btn-undo" onclick="undoLast()">â†© ä¸Šä¸€é¡Œ</button>
                <div id="status-display" class="info-badge">ç¬¬ 1 / 10 é¡Œ</div>
                <button class="btn btn-home" onclick="goHome()">ğŸ </button>
            </div>

            <img src="https://placehold.co/150x150/89CFF0/FFFFFF?text=Thinking" alt="æ€è€ƒä¸­" class="character-img" id="game-img">
            
            <div id="question-area"></div>
            
            <div id="feedback-area" style="height:30px; font-weight:bold; color:var(--primary-blue); margin:5px 0;"></div>

            <div id="options-area" class="options-grid"></div>
        </div>

        <div id="report-screen" class="screen">
            <img src="https://placehold.co/150x150/98FB98/FFFFFF?text=Good+Job" alt="å¥½æ£’" class="character-img" id="report-img">
            <h1 style="font-size: 2rem; color: #E65100;">æŒ‘æˆ°å®Œæˆï¼</h1>
            
            <div class="result-box">
                <div class="result-item">ç­”å°é¡Œæ•¸ <span class="result-value" id="res-correct" style="color:#4CAF50">10</span></div>
                <div class="result-item">ç­”éŒ¯æ¬¡æ•¸ <span class="result-value" id="res-wrong" style="color:#FF6B6B">0</span></div>
                <div class="result-item" id="res-time-row">ç¸½å…±èŠ±è²» <span class="result-value" id="res-time">0 ç§’</span></div>
            </div>

            <button class="btn btn-restart" onclick="goHome()">å†ç©ä¸€æ¬¡</button>
        </div>

    </div>

    <script>
        const QUESTIONS_PER_ROUND = 10; 
        
        // éŸ³æ•ˆè¨­å®š
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523.25, audioCtx.currentTime);
                osc.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        const IMAGES = {
            normal: "https://placehold.co/150x150/89CFF0/FFFFFF?text=Thinking",
            happy: "https://placehold.co/150x150/98FB98/FFFFFF?text=Correct!",
            sad: "https://placehold.co/150x150/FFB7C5/FFFFFF?text=Try+Again",
            finish: "https://placehold.co/150x150/FFD700/FFFFFF?text=Winner"
        };

        // 50é¡Œç´ é¤Šé¡Œ
        const storyQuestions = [
            { t: "ä¸€(ã„§Ë‹) éš»(ã„“) å¤§(ã„‰ã„šË‹) è€³(ã„¦Ë‡) ç‹—(ã„ã„¡Ë‡) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>2</span> éš»(ã„“) è€³(ã„¦Ë‡) æœµ(ã„‰ã„¨ã„›Ë™) ï¼Œ <span class='highlight'>6</span> éš»(ã„“) å¤§(ã„‰ã„šË‹) è€³(ã„¦Ë‡) ç‹—(ã„ã„¡Ë‡) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) è€³(ã„¦Ë‡) æœµ(ã„‰ã„¨ã„›Ë™) ï¼Ÿ", a: 12 },
            { t: "è…³(ã„ã„§ã„ Ë‡) è¸(ã„Šã„šË‹) è»Š(ã„”ã„œ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>2</span> å€‹(ã„ã„œË™) è¼ª(ã„Œã„¨ã„£ËŠ) å­(ã„—Ë™) ï¼Œ <span class='highlight'>9</span> è¼›(ã„Œã„§ã„¤Ë‹) è…³(ã„ã„§ã„ Ë‡) è¸(ã„Šã„šË‹) è»Š(ã„”ã„œ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) è¼ª(ã„Œã„¨ã„£ËŠ) å­(ã„—Ë™) ï¼Ÿ", a: 18 },
            { t: "ä¸€(ã„§Ë‹) é›™(ã„•ã„¨ã„¤) ç­·(ã„ã„¨ã„Ë‹) å­(ã„—Ë™) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>2</span> æ ¹(ã„ã„£) ï¼Œ <span class='highlight'>8</span> é›™(ã„•ã„¨ã„¤) ç­·(ã„ã„¨ã„Ë‹) å­(ã„—Ë™) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) æ ¹(ã„ã„£) ï¼Ÿ", a: 16 },
            { t: "äºº(ã„–ã„£ËŠ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>2</span> éš»(ã„“) çœ¼(ã„§ã„¢Ë‡) ç›(ã„ã„§ã„¥) ï¼Œ <span class='highlight'>5</span> å€‹(ã„ã„œË™) äºº(ã„–ã„£ËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) çœ¼(ã„§ã„¢Ë‡) ç›(ã„ã„§ã„¥) ï¼Ÿ", a: 10 },
            { t: "ä¸€(ã„§Ë‹) é›™(ã„•ã„¨ã„¤) é‹(ã„’ã„§ã„ËŠ) å­(ã„—Ë™) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>2</span> éš»(ã„“) ï¼Œ <span class='highlight'>7</span> é›™(ã„•ã„¨ã„¤) é‹(ã„’ã„§ã„ËŠ) å­(ã„—Ë™) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) ï¼Ÿ", a: 14 },
            { t: "ä¸‰(ã„™ã„¢) è¼ª(ã„Œã„¨ã„£ËŠ) è»Š(ã„”ã„œ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>3</span> å€‹(ã„ã„œË™) è¼ª(ã„Œã„¨ã„£ËŠ) å­(ã„—Ë™) ï¼Œ <span class='highlight'>4</span> è¼›(ã„Œã„§ã„¤Ë‹) ä¸‰(ã„™ã„¢) è¼ª(ã„Œã„¨ã„£ËŠ) è»Š(ã„”ã„œ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) è¼ª(ã„Œã„¨ã„£ËŠ) å­(ã„—Ë™) ï¼Ÿ", a: 12 },
            { t: "å¸ƒ(ã„…ã„¨Ë‹) ä¸(ã„‰ã„§ã„¥) <span class='highlight'>3</span> å€‹(ã„ã„œË™) è£(ã„“ã„¨ã„¤) ä¸€(ã„§Ë‹) ç›’(ã„ã„œËŠ) ï¼Œ <span class='highlight'>6</span> ç›’(ã„ã„œËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) å¸ƒ(ã„…ã„¨Ë‹) ä¸(ã„‰ã„§ã„¥) ï¼Ÿ", a: 18 },
            { t: "ä¸€(ã„§Ë‹) å¤©(ã„Šã„§ã„¢) åƒ(ã„”) <span class='highlight'>3</span> é¤(ã„˜ã„¢) ï¼Œ <span class='highlight'>5</span> å¤©(ã„Šã„§ã„¢) å…±(ã„ã„¨ã„¥Ë‹) åƒ(ã„”) äº†(ã„Œã„œË™) å¹¾(ã„ã„§Ë‡) é¤(ã„˜ã„¢) ï¼Ÿ", a: 15 },
            { t: "å¼Ÿ(ã„‰ã„§Ë‹) å¼Ÿ(ã„‰ã„§Ë™) æ¯(ã„‡ã„ŸË‡) å¤©(ã„Šã„§ã„¢) å­˜(ã„˜ã„¨ã„£ËŠ) <span class='highlight'>3</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ <span class='highlight'>9</span> å¤©(ã„Šã„§ã„¢) å¯(ã„ã„œË‡) ä»¥(ã„§Ë‡) å­˜(ã„˜ã„¨ã„£ËŠ) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 27 },
            { t: "å¹¸(ã„’ã„§ã„¥Ë‹) é‹(ã„©ã„£Ë‹) è‰(ã„˜ã„ Ë‡) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>3</span> ç‰‡(ã„†ã„§ã„¢Ë‹) è‘‰(ã„§ã„Ë‹) å­(ã„—Ë™) ï¼Œ <span class='highlight'>8</span> æ ª(ã„“ã„¨) å¹¸(ã„’ã„§ã„¥Ë‹) é‹(ã„©ã„£Ë‹) è‰(ã„˜ã„ Ë‡) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) ç‰‡(ã„†ã„§ã„¢Ë‹) è‘‰(ã„§ã„Ë‹) å­(ã„—Ë™) ï¼Ÿ", a: 24 },
            { t: "æ±½(ã„‘ã„§Ë‹) è»Š(ã„”ã„œ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>4</span> å€‹(ã„ã„œË™) è¼ª(ã„Œã„¨ã„£ËŠ) å­(ã„—Ë™) ï¼Œ <span class='highlight'>5</span> è¼›(ã„Œã„§ã„¤Ë‹) æ±½(ã„‘ã„§Ë‹) è»Š(ã„”ã„œ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) è¼ª(ã„Œã„¨ã„£ËŠ) å­(ã„—Ë™) ï¼Ÿ", a: 20 },
            { t: "æ¤…(ã„§Ë‡) å­(ã„—Ë™) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>4</span> éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Œ <span class='highlight'>6</span> å¼µ(ã„“ã„¤) æ¤…(ã„§Ë‡) å­(ã„—Ë™) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Ÿ", a: 24 },
            { t: "å°(ã„’ã„§ã„ Ë‡) ç‹—(ã„ã„¡Ë‡) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>4</span> æ¢(ã„Šã„§ã„ ËŠ) è…¿(ã„Šã„¨ã„ŸË‡) ï¼Œ <span class='highlight'>3</span> éš»(ã„“) å°(ã„’ã„§ã„ Ë‡) ç‹—(ã„ã„¡Ë‡) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) æ¢(ã„Šã„§ã„ ËŠ) è…¿(ã„Šã„¨ã„ŸË‡) ï¼Ÿ", a: 12 },
            { t: "ä¸€(ã„§Ë‹) ç›’(ã„ã„œËŠ) é»(ã„‰ã„§ã„¢Ë‡) å¿ƒ(ã„’ã„§ã„£) <span class='highlight'>4</span> å€‹(ã„ã„œË™) ï¼Œ <span class='highlight'>9</span> ç›’(ã„ã„œËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) é»(ã„‰ã„§ã„¢Ë‡) å¿ƒ(ã„’ã„§ã„£) ï¼Ÿ", a: 36 },
            { t: "æ­£(ã„“ã„¥Ë‹) æ–¹(ã„ˆã„¤) å½¢(ã„’ã„§ã„¥ËŠ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>4</span> å€‹(ã„ã„œË™) é‚Š(ã„…ã„§ã„¢) ï¼Œ <span class='highlight'>7</span> å€‹(ã„ã„œË™) æ­£(ã„“ã„¥Ë‹) æ–¹(ã„ˆã„¤) å½¢(ã„’ã„§ã„¥ËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) é‚Š(ã„…ã„§ã„¢) ï¼Ÿ", a: 28 },
            { t: "ä¸€(ã„§Ë‹) éš»(ã„“) æ‰‹(ã„•ã„¡Ë‡) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>5</span> æ ¹(ã„ã„£) æ‰‹(ã„•ã„¡Ë‡) æŒ‡(ã„“Ë‡) é ­(ã„Šã„¡Ë™) ï¼Œ <span class='highlight'>4</span> éš»(ã„“) æ‰‹(ã„•ã„¡Ë‡) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) æ ¹(ã„ã„£) ï¼Ÿ", a: 20 },
            { t: "æµ·(ã„ã„Ë‡) æ˜Ÿ(ã„’ã„§ã„¥) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>5</span> å€‹(ã„ã„œË™) è§’(ã„ã„§ã„ Ë‡) ï¼Œ <span class='highlight'>6</span> éš»(ã„“) æµ·(ã„ã„Ë‡) æ˜Ÿ(ã„’ã„§ã„¥) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) è§’(ã„ã„§ã„ Ë‡) ï¼Ÿ", a: 30 },
            { t: "èŠ±(ã„ã„¨ã„š) æœµ(ã„‰ã„¨ã„›Ë‡) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>5</span> ç‰‡(ã„†ã„§ã„¢Ë‹) èŠ±(ã„ã„¨ã„š) ç“£(ã„…ã„¢Ë‹) ï¼Œ <span class='highlight'>9</span> æœµ(ã„‰ã„¨ã„›Ë‡) èŠ±(ã„ã„¨ã„š) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) ç‰‡(ã„†ã„§ã„¢Ë‹) èŠ±(ã„ã„¨ã„š) ç“£(ã„…ã„¢Ë‹) ï¼Ÿ", a: 45 },
            { t: "ä¸€(ã„§Ë‹) å€‹(ã„ã„œË™) éŠ…(ã„Šã„¨ã„¥ËŠ) æ¿(ã„…ã„¢Ë‡) <span class='highlight'>5</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ <span class='highlight'>8</span> å€‹(ã„ã„œË™) éŠ…(ã„Šã„¨ã„¥ËŠ) æ¿(ã„…ã„¢Ë‡) æ˜¯(ã„•Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 40 },
            { t: "å°(ã„’ã„§ã„ Ë‡) æœ‹(ã„†ã„¥ËŠ) å‹(ã„§ã„¡Ë‡) <span class='highlight'>5</span> äºº(ã„–ã„£ËŠ) ä¸€(ã„§Ë‹) çµ„(ã„—ã„¨Ë‡) ï¼Œ <span class='highlight'>7</span> çµ„(ã„—ã„¨Ë‡) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) äºº(ã„–ã„£ËŠ) ï¼Ÿ", a: 35 },
            { t: "è(ã„‡ã„šË‡) èŸ»(ã„§Ë‡) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>6</span> éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Œ <span class='highlight'>3</span> éš»(ã„“) è(ã„‡ã„šË‡) èŸ»(ã„§Ë‡) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Ÿ", a: 18 },
            { t: "ä¸€(ã„§Ë‹) ç›’(ã„ã„œËŠ) é›(ã„ã„§) è›‹(ã„‰ã„¢Ë‹) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>6</span> é¡†(ã„ã„œ) ï¼Œ <span class='highlight'>5</span> ç›’(ã„ã„œËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) é¡†(ã„ã„œ) é›(ã„ã„§) è›‹(ã„‰ã„¢Ë‹) ï¼Ÿ", a: 30 },
            { t: "èœœ(ã„‡ã„§Ë‹) èœ‚(ã„ˆã„¥) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>6</span> éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Œ <span class='highlight'>8</span> éš»(ã„“) èœœ(ã„‡ã„§Ë‹) èœ‚(ã„ˆã„¥) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Ÿ", a: 48 },
            { t: "ä¸€(ã„§Ë‹) ç®±(ã„’ã„§ã„¤) é£²(ã„§ã„£Ë‡) æ–™(ã„Œã„§ã„ Ë‹) <span class='highlight'>6</span> ç“¶(ã„†ã„§ã„¥ËŠ) ï¼Œ <span class='highlight'>9</span> ç®±(ã„’ã„§ã„¤) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) ç“¶(ã„†ã„§ã„¥ËŠ) ï¼Ÿ", a: 54 },
            { t: "éª°(ã„Šã„¡ËŠ) å­(ã„—Ë™) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>6</span> å€‹(ã„ã„œË™) é¢(ã„‡ã„§ã„¢Ë‹) ï¼Œ <span class='highlight'>4</span> é¡†(ã„ã„œ) éª°(ã„Šã„¡ËŠ) å­(ã„—Ë™) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) é¢(ã„‡ã„§ã„¢Ë‹) ï¼Ÿ", a: 24 },
            { t: "ä¸€(ã„§Ë‹) æ˜Ÿ(ã„’ã„§ã„¥) æœŸ(ã„‘ã„§ËŠ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>7</span> å¤©(ã„Šã„§ã„¢) ï¼Œ <span class='highlight'>2</span> å€‹(ã„ã„œË™) æ˜Ÿ(ã„’ã„§ã„¥) æœŸ(ã„‘ã„§ËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å¤©(ã„Šã„§ã„¢) ï¼Ÿ", a: 14 },
            { t: "å½©(ã„˜ã„Ë‡) è™¹(ã„ã„¨ã„¥ËŠ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>7</span> ç¨®(ã„“ã„¨ã„¥Ë‡) é¡(ã„§ã„¢ËŠ) è‰²(ã„™ã„œË‹) ï¼Œ <span class='highlight'>3</span> é“(ã„‰ã„ Ë‹) å½©(ã„˜ã„Ë‡) è™¹(ã„ã„¨ã„¥ËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) ç¨®(ã„“ã„¨ã„¥Ë‡) é¡(ã„§ã„¢ËŠ) è‰²(ã„™ã„œË‹) ï¼Ÿ", a: 21 },
            { t: "å°(ã„’ã„§ã„ Ë‡)çŸ®(ã„Ë‡)äºº(ã„–ã„£ËŠ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>7</span> å€‹(ã„ã„œË™) ï¼Œ <span class='highlight'>5</span> çµ„(ã„—ã„¨Ë‡) å°(ã„’ã„§ã„ Ë‡)çŸ®(ã„Ë‡)äºº(ã„–ã„£ËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) å€‹(ã„ã„œË™) ï¼Ÿ", a: 35 },
            { t: "ä¸€(ã„§Ë‹) åŒ…(ã„…ã„ ) ç³–(ã„Šã„¤ËŠ) æœ(ã„ã„¨ã„›Ë‡) <span class='highlight'>7</span> é¡†(ã„ã„œ) ï¼Œ <span class='highlight'>8</span> åŒ…(ã„…ã„ ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) é¡†(ã„ã„œ) ï¼Ÿ", a: 56 },
            { t: "åŒ—(ã„…ã„ŸË‡) æ–—(ã„‰ã„¡Ë‡) ä¸ƒ(ã„‘ã„§) æ˜Ÿ(ã„’ã„§ã„¥) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>7</span> é¡†(ã„ã„œ) æ˜Ÿ(ã„’ã„§ã„¥) æ˜Ÿ(ã„’ã„§ã„¥) ï¼Œ <span class='highlight'>9</span> å€‹(ã„ã„œË™) æ˜Ÿ(ã„’ã„§ã„¥) åº§(ã„—ã„¨ã„›Ë‹) å…±(ã„ã„¨ã„¥Ë‹) å¹¾(ã„ã„§Ë‡) é¡†(ã„ã„œ) ï¼Ÿ", a: 63 },
            { t: "èœ˜(ã„“) è››(ã„“ã„¨) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>8</span> éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Œ <span class='highlight'>3</span> éš»(ã„“) èœ˜(ã„“) è››(ã„“ã„¨) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Ÿ", a: 24 },
            { t: "ç« (ã„“ã„¤) é­š(ã„©ËŠ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>8</span> éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Œ <span class='highlight'>6</span> éš»(ã„“) ç« (ã„“ã„¤) é­š(ã„©ËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) éš»(ã„“) è…³(ã„ã„§ã„ Ë‡) ï¼Ÿ", a: 48 },
            { t: "ä¸€(ã„§Ë‹) ç›’(ã„ã„œËŠ) è Ÿ(ã„Œã„šË‹) ç­†(ã„…ã„§Ë‡) <span class='highlight'>8</span> æ(ã„“) ï¼Œ <span class='highlight'>5</span> ç›’(ã„ã„œËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) æ(ã„“) ï¼Ÿ", a: 40 },
            { t: "æŠ«(ã„†ã„§) è–©(ã„™ã„šË‹) åˆ‡(ã„‘ã„§ã„) æˆ(ã„”ã„¥ËŠ) <span class='highlight'>8</span> ç‰‡(ã„†ã„§ã„¢Ë‹) ï¼Œ <span class='highlight'>4</span> å€‹(ã„ã„œË™) æŠ«(ã„†ã„§) è–©(ã„™ã„šË‹) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) ç‰‡(ã„†ã„§ã„¢Ë‹) ï¼Ÿ", a: 32 },
            { t: "è²·(ã„‡ã„Ë‡) ä¸€(ã„§Ë‹) æ(ã„“) ç­†(ã„…ã„§Ë‡) <span class='highlight'>8</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>9</span> æ(ã„“) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 72 },
            { t: "æ£’(ã„…ã„¤Ë‹) çƒ(ã„‘ã„§ã„¡ËŠ) éšŠ(ã„‰ã„¨ã„ŸË‹) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>9</span> å€‹(ã„ã„œË™) äºº(ã„–ã„£ËŠ) ï¼Œ <span class='highlight'>2</span> å€‹(ã„ã„œË™) çƒ(ã„‘ã„§ã„¡ËŠ) éšŠ(ã„‰ã„¨ã„ŸË‹) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) äºº(ã„–ã„£ËŠ) ï¼Ÿ", a: 18 },
            { t: "ä¸€(ã„§Ë‹) å€‹(ã„ã„œË™) è‚‰(ã„–ã„¡Ë‹) æ¡‚(ã„ã„¨ã„ŸË‹) æ²(ã„ã„©ã„¢Ë‡) <span class='highlight'>9</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>5</span> å€‹(ã„ã„œË™) è¦(ã„§ã„ Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 45 },
            { t: "ä¸€(ã„§Ë‹) ç›’(ã„ã„œËŠ) å·§(ã„‘ã„§ã„ Ë‡) å…‹(ã„ã„œË‹) åŠ›(ã„Œã„§Ë‹) <span class='highlight'>9</span> é¡†(ã„ã„œ) ï¼Œ <span class='highlight'>3</span> ç›’(ã„ã„œËŠ) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) é¡†(ã„ã„œ) ï¼Ÿ", a: 27 },
            { t: "è˜‹(ã„†ã„§ã„£ËŠ) æœ(ã„ã„¨ã„›Ë‡) ä¸€(ã„§Ë‹) é¡†(ã„ã„œ) <span class='highlight'>9</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ åª½(ã„‡ã„š) åª½(ã„‡ã„š) è²·(ã„‡ã„Ë‡) <span class='highlight'>7</span> é¡†(ã„ã„œ) è¦(ã„§ã„ Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 63 },
            { t: "ä¹(ã„ã„§ã„¡Ë‡) å®®(ã„ã„¨ã„¥) æ ¼(ã„ã„œËŠ) æœ‰(ã„§ã„¡Ë‡) <span class='highlight'>9</span> æ ¼(ã„ã„œËŠ) ï¼Œ <span class='highlight'>4</span> å¼µ(ã„“ã„¤) ç´™(ã„“Ë‡) å…±(ã„ã„¨ã„¥Ë‹) æœ‰(ã„§ã„¡Ë‡) å¹¾(ã„ã„§Ë‡) æ ¼(ã„ã„œËŠ) ï¼Ÿ", a: 36 },
            { t: "æ°£(ã„‘ã„§Ë‹) çƒ(ã„‘ã„§ã„¡ËŠ) ä¸€(ã„§Ë‹) å€‹(ã„ã„œË™) <span class='highlight'>2</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>8</span> å€‹(ã„ã„œË™) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 16 },
            { t: "å£(ã„ã„¡Ë‡) ç½©(ã„“ã„ Ë‹) ä¸€(ã„§Ë‹) ç‰‡(ã„†ã„§ã„¢Ë‹) <span class='highlight'>3</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>7</span> ç‰‡(ã„†ã„§ã„¢Ë‹) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 21 },
            { t: "è²¼(ã„Šã„§ã„) ç´™(ã„“Ë‡) ä¸€(ã„§Ë‹) å¼µ(ã„“ã„¤) <span class='highlight'>4</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>6</span> å¼µ(ã„“ã„¤) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 24 },
            { t: "é‰›(ã„‘ã„§ã„¢) ç­†(ã„…ã„§Ë‡) ä¸€(ã„§Ë‹) æ(ã„“) <span class='highlight'>5</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>9</span> æ(ã„“) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 45 },
            { t: "ç©(ã„¨ã„¢ËŠ) å…·(ã„ã„©Ë‹) è»Š(ã„”ã„œ) <span class='highlight'>6</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>3</span> è¼›(ã„Œã„§ã„¤Ë‹) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 18 },
            { t: "ç­†(ã„…ã„§Ë‡) è¨˜(ã„ã„§Ë‹) æœ¬(ã„…ã„£Ë‡) <span class='highlight'>7</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>4</span> æœ¬(ã„…ã„£Ë‡) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 28 },
            { t: "å†°(ã„…ã„§ã„¥) æ·‡(ã„‘ã„§ËŠ) æ·‹(ã„Œã„§ã„£ËŠ) <span class='highlight'>8</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>2</span> æ”¯(ã„“) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 16 },
            { t: "ä¸‰(ã„™ã„¢) æ˜(ã„‡ã„§ã„¥ËŠ) æ²»(ã„“Ë‹) <span class='highlight'>9</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>6</span> å€‹(ã„ã„œË™) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 54 },
            { t: "å°º(ã„”Ë‡) ä¸€(ã„§Ë‹) æŠŠ(ã„…ã„šË‡) <span class='highlight'>5</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>5</span> æŠŠ(ã„…ã„šË‡) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 25 },
            { t: "æ©¡(ã„’ã„§ã„¤Ë‹) çš®(ã„†ã„§ËŠ) æ“¦(ã„˜ã„š) <span class='highlight'>4</span> å…ƒ(ã„©ã„¢ËŠ) ï¼Œ è²·(ã„‡ã„Ë‡) <span class='highlight'>8</span> å€‹(ã„ã„œË™) è¦(ã„§ã„ Ë‹) ä»˜(ã„ˆã„¨Ë‹) å¤š(ã„‰ã„¨ã„›) å°‘(ã„•ã„ Ë‡) å…ƒ(ã„©ã„¢ËŠ) ï¼Ÿ", a: 32 }
        ];

        // éŠæˆ²ç‹€æ…‹
        let state = {
            mode: 'basic',
            targetNum: 0,
            isTimerEnabled: false,
            qIndex: 0,
            correctCount: 0,
            wrongCount: 0,
            startTime: 0,
            currentQ: null,
            history: [],
            questionQueue: [] // å„²å­˜é å…ˆç”Ÿæˆçš„é¡Œç›®ä½‡åˆ—
        };

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function goHome() {
            showScreen('menu-screen');
            document.getElementById('menu-img').src = "menu_cinnamoroll.png"; 
        }

        function initGame(mode, num) {
            const timerSwitch = document.getElementById('timer-toggle');
            state.isTimerEnabled = timerSwitch.checked;
            state.mode = mode;
            state.targetNum = num;
            state.qIndex = 0;
            state.correctCount = 0;
            state.wrongCount = 0;
            state.history = [];
            
            // é å…ˆç”Ÿæˆé¡Œç›®ä½‡åˆ—
            generateQuestionQueue(mode, num);

            state.startTime = Date.now();
            showScreen('game-screen');
            nextQuestion(false);
        }

        // ç”¢ç”Ÿä¸€å›åˆçš„é¡Œç›®ä½‡åˆ—
        function generateQuestionQueue(mode, num) {
            state.questionQueue = [];
            
            if (mode === 'basic') {
                if (num > 0) {
                    // æŒ‡å®šæ•¸å­—ï¼šç”¢ç”Ÿ n*1 åˆ° n*10
                    let pool = [];
                    for(let i=1; i<=10; i++) {
                        pool.push({ n1: num, n2: i });
                    }
                    // æ´—ç‰Œ
                    shuffleArray(pool);
                    state.questionQueue = pool;
                } else {
                    // æ··åˆç·´ç¿’ï¼šç”¢ç”Ÿ10é¡Œä¸é‡è¤‡çš„éš¨æ©Ÿé¡Œç›®
                    let pool = [];
                    let used = new Set();
                    while(pool.length < 10) {
                        let n1 = Math.floor(Math.random() * 8) + 2; // 2~9
                        let n2 = Math.floor(Math.random() * 9) + 1; // 1~9
                        let key = `${n1}-${n2}`;
                        if (!used.has(key)) {
                            used.add(key);
                            pool.push({ n1: n1, n2: n2 });
                        }
                    }
                    state.questionQueue = pool;
                }
            } else {
                // ç´ é¤Šé¡Œï¼šéš¨æ©ŸæŠ½10é¡Œ (ç°¡å–®éš¨æ©Ÿï¼Œè‹¥è¦åš´æ ¼ä¸é‡è¤‡ä¹Ÿå¯åŠ  Set)
                // é€™è£¡ç°¡å–®å¾50é¡Œä¸­éš¨æ©ŸæŠ½10é¡Œä¸é‡è¤‡
                let indices = Array.from({length: storyQuestions.length}, (_, i) => i);
                shuffleArray(indices);
                let selectedIndices = indices.slice(0, 10);
                state.questionQueue = selectedIndices.map(i => storyQuestions[i]);
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function nextQuestion(isUndo) {
            if (!isUndo && state.qIndex >= QUESTIONS_PER_ROUND) {
                showReport();
                return;
            }

            if (!isUndo) {
                state.qIndex++;
                
                // å¾ä½‡åˆ—ä¸­å–å‡ºé¡Œç›®
                if (state.mode === 'story') {
                    // ç´ é¤Šé¡Œä½‡åˆ—è£¡å­˜çš„æ˜¯å®Œæ•´é¡Œç›®ç‰©ä»¶
                    // ä½†æˆ‘å€‘éœ€è¦é…åˆ generateQuestionData çš„å›å‚³æ ¼å¼ï¼Œé€™è£¡åšä¸€é»è½‰æ›
                    let qData = state.questionQueue[state.qIndex - 1]; // å› ç‚º qIndex æ˜¯å¾ 1 é–‹å§‹é¡¯ç¤º
                    let qText = qData.t.replace(/\(([^)]+)\)/g, "<span class='zhu'>$1</span>");
                    
                    state.currentQ = { 
                        text: qText, 
                        ans: qData.a, 
                        options: generateOptions(qData.a), 
                        type: 'story' 
                    };

                } else {
                    // åŸºç¤é¡Œä½‡åˆ—è£¡å­˜çš„æ˜¯ {n1, n2}
                    let qPair = state.questionQueue[state.qIndex - 1];
                    let val = qPair.n1 * qPair.n2;
                    
                    state.currentQ = {
                        text: `${qPair.n1} Ã— ${qPair.n2} = ?`,
                        ans: val,
                        options: generateOptions(val),
                        type: 'basic'
                    };
                }
                
                state.history.push({...state.currentQ});
            }

            updateStatusDisplay();
            renderGame();
        }

        function undoLast() {
            if (state.history.length <= 1) return;
            state.history.pop();
            const prev = state.history[state.history.length - 1];
            state.currentQ = prev;
            state.qIndex--; 
            updateStatusDisplay();
            renderGame();
        }

        function updateStatusDisplay() {
            const display = document.getElementById('status-display');
            if (state.isTimerEnabled) {
                display.innerText = `ç¬¬ ${state.qIndex} / ${QUESTIONS_PER_ROUND} é¡Œ (è¨ˆæ™‚ä¸­)`;
                display.style.color = "#E65100";
                display.style.borderColor = "#FFCC80";
                display.style.background = "#FFF3E0";
            } else {
                display.innerText = `ç¬¬ ${state.qIndex} / ${QUESTIONS_PER_ROUND} é¡Œ`;
                display.style.color = "#555";
                display.style.borderColor = "#ccc";
                display.style.background = "#eee";
            }
        }

        function generateOptions(correctAnswer) {
            let opts = new Set();
            opts.add(correctAnswer);
            while(opts.size < 4) {
                let offset = Math.floor(Math.random() * 10) - 5; 
                let wrong = correctAnswer + offset;
                if (wrong > 0 && wrong !== correctAnswer) opts.add(wrong);
            }
            return Array.from(opts).sort(() => Math.random() - 0.5);
        }

        function renderGame() {
            const qArea = document.getElementById('question-area');
            const optArea = document.getElementById('options-area');
            const img = document.getElementById('game-img');
            const undoBtn = document.getElementById('btn-undo');
            const feedback = document.getElementById('feedback-area');

            img.src = IMAGES.normal;
            undoBtn.disabled = (state.qIndex <= 1);
            feedback.innerText = "";

            if (state.currentQ.type === 'story') {
                qArea.innerHTML = `<div class='story-text'>${state.currentQ.text}</div>`;
            } else {
                qArea.innerHTML = `<div class='question-box-basic'>${state.currentQ.text}</div>`;
            }

            optArea.innerHTML = "";
            state.currentQ.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt, btn);
                optArea.appendChild(btn);
            });
        }

        function checkAnswer(selectedVal, btnElement) {
            const img = document.getElementById('game-img');
            const feedback = document.getElementById('feedback-area');

            if (selectedVal === state.currentQ.ans) {
                playSound('correct');
                btnElement.classList.add('correct-anim');
                img.src = IMAGES.happy;
                
                state.correctCount++;
                feedback.innerText = "ç­”å°äº†ï¼";
                
                const btns = document.querySelectorAll('.option-btn');
                btns.forEach(b => b.disabled = true);
                
                setTimeout(() => nextQuestion(false), 1000);

            } else {
                playSound('wrong');
                btnElement.classList.add('wrong-anim');
                img.src = IMAGES.sad;
                feedback.innerText = "å†è©¦è©¦çœ‹ï¼";
                state.wrongCount++;
            }
        }

        function showReport() {
            showScreen('report-screen');
            document.getElementById('report-img').src = IMAGES.finish;
            
            document.getElementById('res-correct').innerText = state.correctCount + " é¡Œ";
            document.getElementById('res-wrong').innerText = state.wrongCount + " æ¬¡";

            const timeRow = document.getElementById('res-time-row');
            if (state.isTimerEnabled) {
                const totalSeconds = ((Date.now() - state.startTime) / 1000).toFixed(1);
                document.getElementById('res-time').innerText = totalSeconds + " ç§’";
                timeRow.style.display = 'block';
            } else {
                timeRow.style.display = 'none';
            }
        }

    </script>
</body>
</html>
